<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 移动端优化 */
        @media (max-width: 640px) {
            body {
                font-size: 14px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
  <div class="min-h-screen pb-8">
    <%- include('../partials/topnav', {
      title: 'My Orders',
      subtitle: (typeof userEmail !== 'undefined' && userEmail) ? userEmail : '',
      containerClass: 'max-w-5xl'
    }) %>

    <div class="max-w-5xl mx-auto px-4 py-6 space-y-4">
      <!-- <div class="bg-white rounded-xl shadow-sm border p-4">
        <div class="text-sm text-gray-600">
          For privacy and security, this page only shows orders for the currently logged-in account.
        </div>
      </div> -->

      <% const statusText = { new: 'New', paid_confirmed: 'Payment confirmed', preparing: 'Preparing', delivering: 'Out for delivery', completed: 'Completed', cancelled: 'Cancelled' }; %>
      <% const statusClass = { new: 'bg-yellow-100 text-yellow-800', paid_confirmed: 'bg-blue-100 text-blue-800', preparing: 'bg-purple-100 text-purple-800', delivering: 'bg-indigo-100 text-indigo-800', completed: 'bg-green-100 text-green-800', cancelled: 'bg-red-100 text-red-800' }; %>

      <% if (!orders || orders.length === 0) { %>
        <div class="bg-white rounded-xl shadow-sm border p-10 text-center">
          <div class="text-lg font-semibold text-gray-800">No orders yet</div>
          <div class="mt-2 text-sm text-gray-500">When you place an order, it will show up here automatically.</div>
          <div class="mt-4">
            <a href="/order" class="text-sm text-blue-600 hover:text-blue-800">Go to group-buy order →</a>
          </div>
        </div>
      <% } else { %>
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm text-blue-800">
          Found <strong><%= orders.length %></strong> order(s)
        </div>

        <div class="space-y-4">
          <% orders.forEach(function(order) { %>
            <div class="bg-white rounded-xl shadow-sm border p-4 sm:p-6">
              <div class="flex items-start justify-between mb-4 pb-4 border-b gap-3">
                <div class="min-w-0">
                  <div class="text-lg font-semibold text-gray-900">Order</div>
                  <div class="text-sm text-gray-500">ID: <span class="font-mono"><%= String(order.id).slice(0, 8) %></span></div>
                  <div class="text-sm text-gray-500">Placed at: <%= new Date(order.createdAt).toLocaleString() %></div>
                </div>
                <span class="px-3 py-1 text-xs font-semibold rounded-full <%= statusClass[order.internalStatus] || 'bg-gray-100 text-gray-800' %>">
                  <%= statusText[order.internalStatus] || order.internalStatus %>
                </span>
              </div>

              <div class="mb-4">
                <div class="text-sm font-medium text-gray-700 mb-2">Delivery</div>
                <div class="bg-gray-50 rounded-lg p-3 space-y-1 text-sm">
                  <div><strong>Name:</strong> <%= order.customerName %></div>
                  <div><strong>Phone:</strong> <%= order.phone %></div>
                  <div><strong>Address:</strong> <%= order.address %></div>
                  <div><strong>Delivery time:</strong> <%= order.deliveryTime %></div>
                </div>
              </div>

              <div class="mb-4">
                <div class="text-sm font-medium text-gray-700 mb-2">Items</div>
                <div class="space-y-2">
                  <% (order.items || []).forEach(function(item) { %>
                    <div class="flex justify-between items-center bg-gray-50 rounded-lg p-3 text-sm">
                      <div class="flex-1">
                        <div class="font-medium text-gray-900"><%= item.title %></div>
                        <div class="text-gray-600">Qty: <%= item.quantity %></div>
                      </div>
                      <div class="text-gray-900 font-semibold">$<%= Number(item.price).toFixed(2) %></div>
                    </div>
                  <% }); %>
                </div>
              </div>

              <div class="mb-4">
                <div class="text-sm font-medium text-gray-700 mb-2">Payment</div>
                <div class="bg-gray-50 rounded-lg p-3 text-sm">
                  <div>
                    <strong>Method:</strong>
                    <%= order.paymentMethod === 'transfer' ? 'Bank transfer' : 'Cash on delivery' %>
                  </div>
                  <% if (order.paymentMethod === 'transfer' && order.paymentScreenshotPath) { %>
                    <div class="mt-2">
                      <div class="text-gray-600 mb-2">Payment proof:</div>
                      <img src="<%= order.paymentScreenshotPath %>" alt="Payment proof" class="max-w-full h-auto rounded border border-gray-300" />
                    </div>
                  <% } %>
                </div>
              </div>

              <% if (order.optionalNote) { %>
                <div>
                  <div class="text-sm font-medium text-gray-700 mb-2">Note</div>
                  <div class="text-sm text-gray-600 bg-gray-50 rounded-lg p-3"><%= order.optionalNote %></div>
                </div>
              <% } %>
            </div>
          <% }); %>
        </div>
      <% } %>
    </div>
  </div>
</body>
</html>

